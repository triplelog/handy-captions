<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
    {% block meta %}
    <meta name="description" content=".">    <title>CSS City</title>  
    <link rel="icon" type="image/png" href="../chfaviconcrop.png">
    {% endblock %}
    


{% block stylesheets %}
{% endblock %}


<style>

.input {
	position: absolute;
	left: 0px;
	top:0px;
	width: 100%;
	height: 50%;
	display: inline-block;
	border: 1px solid black;
	
}
.output {
	position: absolute;
	left: 0px;
	top:50%;
	width: 150px;
	height: 60px;
	display: inline-block;
	border: 1px solid red;
	/*background-image: url("img/pexels-photo-963278.jpeg");
	background-color: black;
	background-size: 300px 300px;*/
	
}
.o2 {
	position: absolute;
	left: 300px;
	top:0%;
	width: 300px;
	height: 300px;
	display: inline-block;
	border: 1px solid red;
	background: gray;
	/*display: none;*/
	/*background-image: url("img/pexels-photo-963278.jpeg");
	background-color: black;
	background-size: 300px 300px;*/
	
}
.tools {
	position: absolute;
	left: 300px;
	top:50%;
	display: inline-block;
	
}
.pt {
	position: absolute;
	display: inline-block;
	background: black;
	width: 1px;
	height: 1px;
}

#pixelOut {
	border:0px solid blue;
	position: absolute;
	bottom: 2rem;
}



</style>
</head>
<body>
<img id="imgBG" src="img/pexels-photo-963278.jpeg" style="display: none;"/>
<div class="input">
	<svg id="isoBG" style="position: absolute;" width="300" height="300" viewBox="0 0 300 300" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
		{% for i in range(0,12) %}
			{% for ii in range(0,8) %}
				{% set cx = 26*i %}
				{% set cy = 45*ii %}
				{% set c = '' + cx + ' ' + cy %}
				<path d="M{{ c }} {{ cx }} {{ cy - 15}} {{ cx + 13 }} {{ cy - 7.5}} {{ c }} {{ cx + 13}} {{ cy - 7.5}} {{ cx + 13 }} {{ cy + 7.5}} {{ c }} {{ cx +13 }} {{ cy + 7.5}} {{ cx }} {{ cy + 15}} {{ c }} {{ cx }} {{ cy + 15}} {{ cx - 13 }} {{ cy + 7.5}} {{ c }} {{ cx - 13 }} {{ cy + 7.5}} {{ cx - 13 }} {{ cy - 7.5}} {{ c }} {{ cx - 13 }} {{ cy - 7.5}} {{ cx }} {{ cy - 15}}" stroke="#BBB" stroke-width="0.5" fill="none" />
				{% set cx = 26*i + 13 %}
				{% set cy = 45*ii + 22.5 %}
				{% set c = '' + cx + ' ' + cy %}
				<path d="M{{ c }} {{ cx }} {{ cy - 15}} {{ cx + 13 }} {{ cy - 7.5}} {{ c }} {{ cx + 13}} {{ cy - 7.5}} {{ cx + 13 }} {{ cy + 7.5}} {{ c }} {{ cx +13 }} {{ cy + 7.5}} {{ cx }} {{ cy + 15}} {{ c }} {{ cx }} {{ cy + 15}} {{ cx - 13 }} {{ cy + 7.5}} {{ c }} {{ cx - 13 }} {{ cy + 7.5}} {{ cx - 13 }} {{ cy - 7.5}} {{ c }} {{ cx - 13 }} {{ cy - 7.5}} {{ cx }} {{ cy - 15}}" stroke="#BBB" stroke-width="0.5" fill="none" />
				
			{% endfor %}
		{% endfor %}
	</svg>
	<svg id="baseBG" style="position: absolute;" viewBox="0 0 300 300" width="300" height="300" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">		<defs>			<linearGradient id="grad1" x1="50%" y1="0%" x2="50%" y2="100%" gradientUnits="userSpaceOnUse">	  <stop offset="0%" style="stop-color:rgb(255,255,255);stop-opacity:1"></stop>			  <stop offset="0%" style="stop-color:rgb(255,255,255);stop-opacity:1"></stop>			  <stop offset="100%" style="stop-color:rgb(50,50,255);stop-opacity:1"></stop>			</linearGradient>			<radialGradient id="grad2" cx="50%" cy="50%" r="50%" fx="50%" fy="50%" gradientUnits="userSpaceOnUse">			  <stop offset="0%" style="stop-color:rgb(255,255,255);stop-opacity:1"></stop>			  <stop offset="100%" style="stop-color:rgb(0,0,255);stop-opacity:1"></stop>			</radialGradient>			<pattern id="img1" patternUnits="userSpaceOnUse" width="100%" height="100%">				<image href="img/pnggrad16rgb.png" x="0" y="0" width="100%" height="100%"></image>			</pattern>		</defs>				<g class="bgSVG">		</g>		<g class="fgSVG">				<path d="M 26.8 134.9 Q 26.8 134.9 26.7 134.8 Q 26.6 134.7 26.4 134.2 Q 26.1 133.7 27.1 133.6 Q 28 133.5 28.9 133.1 Q 29.7 132.7 30.4 132.4 Q 31 132.1 32 131.5 Q 33.1 130.9 34.7 129.7 Q 36.4 128.5 36.9 128.1 Q 37.5 127.7 38.3 127.3 Q 39.1 126.9 40.4 126.1 Q 41.8 125.3 42.5 124.9 Q 43.2 124.4 44.3 123.6 Q 45.4 122.9 46.8 122.1 Q 48.3 121.3 49.2 120.8 Q 50 120.4 51.1 120.1 Q 52.2 119.7 53.2 119.3 Q 54.2 118.9 54.9 118.5 Q 55.5 118.1 56.1 117.8 Q 56.6 117.5 57.1 117.2 Q 57.6 116.9 59.2 116.2 Q 60.8 115.5 61.5 115.1 Q 62.2 114.8 63.3 114.3 Q 64.4 113.8 66.3 112.9 Q 68.2 111.9 69 111.6 Q 69.7 111.3 70.5 110.9 Q 71.4 110.5 72.7 109.4 Q 73.9 108.3 74.4 107.7 Q 74.8 107.2 75.3 106.6 Q 75.8 106 78.8 104.5 Q 81.8 103.1 82.3 102.9 Q 82.8 102.7 83.8 102.2 Q 84.7 101.7 86.9 100.7 Q 89.1 99.6 90.2 99.2 Q 91.4 98.7 92.6 98.3 Q 93.9 97.9 96 96.9 Q 98 96 99.2 95.3 Q 100.3 94.5 101.1 93.9 Q 101.9 93.2 103 92.2 Q 104.1 91.1 105.9 90.2 Q 107.6 89.3 108.3 89 Q 109 88.7 110.8 88.1 Q 112.6 87.6 113.3 87.3 Q 114 87.1 114.6 86.9 Q 115.2 86.7 117.4 85.7 Q 119.7 84.7 120.6 84.3 Q 121.5 83.8 122.6 83.2 Q 123.7 82.5 125.4 81.3 Q 127.1 80.1 127.7 79.6 Q 128.3 79.2 128.6 78.8 Q 129 78.3 131.3 75.9 Q 133.5 73.4 134.2 73.1 Q 134.9 72.7 137 71.7 Q 139 70.6 140.2 70.2 Q 141.3 69.7 142.3 69.3 Q 143.3 68.8 145 67.9 Q 146.7 66.9 147.4 66.5 Q 148 66.1 149 65.6 Q 149.9 65.1 152 63.9 Q 154.1 62.6 154.6 62.3 Q 155.1 61.9 155.6 61.6 Q 156.2 61.3 157.4 60.7 Q 158.6 60.1 159.8 59.2 Q 161.1 58.2 161.9 57.7 Q 162.7 57.1 163.9 56.3 Q 165.2 55.5 168.1 53.8 Q 171 52 171.8 51.5 Q 172.5 51.1 173.5 50.6 Q 174.4 50.1 176.3 48.9 Q 178.2 47.7 178.9 47.2 Q 179.7 46.7 180.2 46.3 Q 180.8 46 182.3 45.8 Q 183.8 45.7 184.1 46.1 Q 184.5 46.5 185.3 47.3 Q 186.1 48.2 186.5 48.7 Q 186.9 49.2 187.4 49.9 Q 187.9 50.6 188.3 51.1 Q 188.7 51.5 189.2 52 Q 189.7 52.4 191.4 53.8 Q 193.2 55.2 194.5 56.3 Q 195.7 57.3 196.1 57.7 Q 196.5 58 197.4 58.5 Q 198.3 59.1 200 59.9 Q 201.7 60.8 202.5 61.2 Q 203.2 61.6 203.8 61.8 Q 204.3 62 207.2 62.4 Q 210.1 62.9 210.6 63.1 Q 211.1 63.3 212.8 64 Q 214.5 64.7 215.8 65.1 Q 217 65.5 218.6 65.9 Q 220.1 66.2 222.3 67 Q 224.4 67.8 224.7 68.2 Q 225.1 68.6 225.5 69 Q 225.8 69.5 227.1 70.8 Q 228.3 72.2 228.9 72.9 Q 229.5 73.5 229.9 73.9 Q 230.3 74.2 232.6 75.8 Q 234.9 77.4 235.5 77.8 Q 236.1 78.1 238.7 79.7 Q 241.3 81.2 242.6 81.9 Q 244 82.5 245 82.9 Q 246 83.4 247.4 84 Q 248.7 84.6 249.6 85.2 Q 250.5 85.8 251.2 86.2 Q 252 86.5 252.5 86.7 Q 253 86.9 253.9 87.4 Q 254.8 87.8 257.1 88.9 Q 259.4 90.1 260.6 90.6 Q 261.7 91.1 263.2 92.1 Q 264.7 93.1 265.5 93.9 Q 266.3 94.8 267.2 95.6 Q 268 96.3 269 97.2 Q 270.1 98 271.8 99 Q 273.5 99.9 274.3 100.5 Q 275.2 101.1 276.8 102.1 Q 278.4 103.1 278.9 103.4 Q 279.4 103.7 280.4 104.3 Q 281.4 104.8 284 105.9 Q 286.5 106.9 287.3 108.2 Q 288 109.4 287.5 111.4 Q 286.9 113.4 286.6 114.3 Q 286.3 115.2 286.1 116.1 Q 285.9 117 285.8 118.8 Q 285.7 120.5 285.8 121.2 Q 285.8 121.9 285.9 122.5 Q 285.9 123.1 286.5 125.8 Q 287 128.5 287.1 129.2 Q 287.2 129.9 287.2 130.9 Q 287.2 131.9 287.2 132.8 Q 287.3 133.6 287.3 134.2 Q 287.3 134.7 287.2 135.3 Q 287.2 135.9 287.1 138.1 Q 287.1 140.4 287.1 141.1 Q 287.2 141.8 287.2 142.3 Q 287.3 142.8 287.3 143.5 Q 287.2 144.3 286.9 146.1 Q 286.6 148 286.5 148.9 Q 286.3 149.8 286.2 150.5 Q 286.1 151.2 286 152.4 Q 285.8 153.6 286.1 155.3 Q 286.4 157 286.6 158.6 Q 286.7 160.2 286.7 160.9 Q 286.8 161.6 286.8 162.4 Q 286.9 163.3 286.2 166 Q 285.6 168.6 284.7 168.9 Q 283.8 169.1 283.2 169.3 Q 282.6 169.6 282 170 Q 281.3 170.5 277.9 172.5 Q 274.5 174.6 273.8 175 Q 273.2 175.4 272.7 175.7 Q 272.2 176 270.5 177 Q 268.7 177.9 267.6 178.5 Q 266.4 179.1 265.3 179.6 Q 264.3 180.1 260.5 181.6 Q 256.8 183.1 255.5 183.7 Q 254.2 184.3 252.7 185.1 Q 251.1 185.8 248.4 187.3 Q 245.7 188.8 244.6 189.4 Q 243.5 190.1 242.2 190.8 Q 241 191.5 237.6 193.6 Q 234.3 195.8 233.2 196.5 Q 232.1 197.1 231.1 197.8 Q 230.1 198.5 228.4 199.5 Q 226.7 200.6 226 201 Q 225.2 201.4 224.4 201.9 Q 223.7 202.3 222.1 203.3 Q 220.5 204.2 219.8 204.5 Q 219.2 204.9 218.5 205.2 Q 217.7 205.6 216.2 206.4 Q 214.7 207.2 214.2 207.5 Q 213.7 207.9 212.4 208.8 Q 211 209.7 210.5 210 Q 210 210.3 209 211 Q 208 211.7 207.5 212 Q 207 212.3 206.4 212.7 Q 205.8 213 204.1 214.1 Q 202.3 215.2 201.8 215.4 Q 201.3 215.6 200.1 216.1 Q 199 216.6 198 216.9 Q 197 217.3 196.1 217.6 Q 195.2 217.9 191.3 220.1 Q 187.4 222.3 186.5 222.7 Q 185.6 223.2 184.3 223.7 Q 183 224.3 182.3 224.6 Q 181.6 224.9 180.4 225.4 Q 179.1 225.9 178.5 226.2 Q 177.9 226.4 176 227.4 Q 174.1 228.4 168.8 230.1 Q 163.5 231.9 161.9 232.6 Q 160.3 233.3 159.2 233.9 Q 158.1 234.6 157.6 235 Q 157.1 235.3 155.6 236.6 Q 154.1 237.8 153.1 238.9 Q 152.1 240 151.6 240.5 Q 151.1 241 150.2 241.9 Q 149.2 242.8 148.2 243.6 Q 147.2 244.4 146.3 245.1 Q 145.3 245.8 144.7 246.2 Q 144.2 246.6 143.6 247.1 Q 143 247.6 141.4 249 Q 139.8 250.3 138.9 250.9 Q 137.9 251.5 136.9 252 Q 135.8 252.5 134.8 253.3 Q 133.8 254 132.9 254.7 Q 132 255.3 130.9 254.6 Q 129.8 253.9 129.3 253.5 Q 128.7 253.1 127.4 252.1 Q 126.1 251.1 125.5 250.5 Q 125 250 124.3 249.2 Q 123.6 248.5 121.7 247.3 Q 119.8 246.1 119 245.6 Q 118.2 245.2 117.6 244.7 Q 117 244.3 115.7 243.7 Q 114.4 243 113.8 242.8 Q 113.2 242.6 112.3 242.3 Q 111.4 242 109.3 241.1 Q 107.1 240.2 105.6 239.5 Q 104.1 238.8 102.9 238 Q 101.7 237.2 101.1 236.8 Q 100.5 236.4 99.9 236 Q 99.4 235.7 97.8 235 Q 96.2 234.2 95 233.7 Q 93.9 233.1 92.7 232.5 Q 91.5 231.8 88.7 230.6 Q 86 229.3 84.8 228.7 Q 83.5 228.2 82.7 227.8 Q 81.8 227.5 78.7 225.8 Q 75.7 224.1 74.6 223.4 Q 73.6 222.7 72.5 222 Q 71.4 221.4 69 220.1 Q 66.7 218.9 65.5 218.2 Q 64.4 217.5 62.7 216.6 Q 61 215.6 57.6 213.6 Q 54.2 211.5 53 210.7 Q 51.8 209.8 51.3 209.4 Q 50.8 209 50.3 208.7 Q 49.8 208.3 49 207.8 Q 48.2 207.3 38.7 201.1 Q 29.1 194.9 29.1 191.8 Q 29 188.8 29.1 188.1 Q 29.1 187.4 29.1 186.5 Q 29.1 185.7 29.1 183.9 Q 29.1 182 29.1 180.8 Q 29.1 179.6 29.2 178.4 Q 29.2 177.2 29.3 174.9 Q 29.4 172.6 29.8 169.2 Q 30.1 165.7 30.3 162.9 Q 30.4 160 30.3 158.9 Q 30.3 157.7 30.2 156.6 Q 30.2 155.4 29.9 152.8 Q 29.5 150.3 29.4 149.2 Q 29.2 148.1 29 147.3 Q 28.9 146.5 28.7 144.8 Q 28.5 143.2 28.4 142.5 Q 28.3 141.8 28.3 141.1 Q 28.3 140.4 30 135.4" stroke="#999" stroke-width="5" fill="none" id="fg-curve-qkef0jo1vs"></path><path d="M 30.5 133 Q 30.4 133.1 30.9 133.6 Q 31.4 134 32 134.6 Q 32.6 135.2 33.5 135.8 Q 34.3 136.5 51.8 144.5 Q 69.3 152.6 70.9 153.2 Q 72.5 153.9 73.7 154.4 Q 75 155 78.1 156.3 Q 81.1 157.6 82.2 158.1 Q 83.3 158.7 84.6 159.4 Q 85.8 160.2 90.5 162.9 Q 95.3 165.6 95.9 166 Q 96.6 166.5 97.6 167.2 Q 98.5 167.8 100.9 169.3 Q 103.4 170.8 104.4 171.5 Q 105.4 172.1 105.9 172.5 Q 106.4 172.8 109.9 175.1 Q 113.3 177.3 113.8 177.6 Q 114.3 177.9 115.3 178.5 Q 116.3 179.2 117.9 180.4 Q 119.5 181.6 120.5 182.3 Q 121.5 183 122.6 183.8 Q 123.7 184.5 124.3 184.9 Q 124.8 185.4 125.4 185.9 Q 126 186.4 127.2 187.5 Q 128.4 188.5 129.2 189.3 Q 130.1 190 131.8 193.6 Q 133.5 197.1 133.4 199.4 Q 133.3 201.7 133.2 203.4 Q 133.2 205.1 133.1 205.6 Q 133 206.1 132.6 208 Q 132.2 209.9 132 211.1 Q 131.8 212.3 131.6 213.6 Q 131.3 214.9 131.1 218.3 Q 130.8 221.7 130.7 223.8 Q 130.7 225.9 130.7 226.6 Q 130.6 227.3 130.7 228.5 Q 130.7 229.7 131.6 236.5 Q 132.5 243.3 132.6 243.9 Q 132.7 244.5 132.9 245.4 Q 133 246.3 133.2 248.7 Q 133.4 251.1 133.4 253.2 Q 133.5 255.3 133.6 256.3 Q 133.7 257.4 133.7 257.6 Q 133.7 257.8 133.6 255.2 Q 133.5 252.5 133.5 249.8 Q 133.4 247.1 133.4 244.6 Q 133.4 242 133.5 236 Q 133.7 230 133.7 227.2 Q 133.7 224.4 133.7 223.9 Q 133.6 223.4 133.3 220.8 Q 133 218.3 133 216.8 Q 133 215.3 133.2 213.6 Q 133.4 211.8 134 208.4 Q 134.5 204.9 134.6 204.1 Q 134.7 203.2 134.6 202.4 Q 134.6 201.7 134.4 200.4 Q 134.2 199.1 134.2 198.5 Q 134.1 198 134.1 197.5 Q 134.1 197 134.2 195.9 Q 134.4 194.8 135.4 194.4 Q 136.3 194 137.3 193.5 Q 138.3 193 138.8 192.8 Q 139.3 192.5 141.1 191.7 Q 142.9 190.9 144.1 190.4 Q 145.2 189.9 146.3 189.5 Q 147.3 189.1 149.7 188.2 Q 152.2 187.4 154.6 185.8 Q 157.1 184.3 158 183.8 Q 159 183.3 159.9 182.8 Q 160.7 182.3 161.8 181.7 Q 162.8 181 167.7 178 Q 172.6 175 175.9 173 Q 179.2 171 180.3 170.3 Q 181.3 169.7 186.9 166.1 Q 192.4 162.4 194.8 161 Q 197.1 159.6 200.8 157.6 Q 204.4 155.5 210.1 152.1 Q 215.8 148.7 218.8 146.7 Q 221.9 144.8 223.3 143.9 Q 224.7 143 228.6 140.4 Q 232.5 137.8 234.4 136.6 Q 236.3 135.4 238.6 134.2 Q 240.9 132.9 245.9 130.2 Q 250.9 127.5 253.3 126.2 Q 255.7 124.9 257.4 124.1 Q 259 123.3 262.9 121.4 Q 266.8 119.5 268.6 118.5 Q 270.4 117.4 272.4 116.3 Q 274.3 115.3 278.8 113.1 Q 283.3 111 284.5 110.3 Q 285.7 109.6 286.4 109 Q 287.1 108.5 289.6 106.3" stroke="#999" stroke-width="5" fill="none" id="fg-curve-xc9inwrwum"></path></g>	
	</svg>
</div>

	<canvas class="output" width="150" height="60">
		
	</canvas>
	<svg id="pixelOut" width="0" height="0" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
	</svg>
	<svg style="display: none;" id="pixelSVG" viewBox="0 0 750 300" width="150" height="60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
	</svg>
	<svg style="display: none;" id="pixelX" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
		<path d="M0 0 L100 100 M0 100 L 100 0" stroke="black" stroke-width="40" fill="none" />
		
	</svg>
<div class="o2" >
	<svg id="textSVG" viewBox="0 0 300 300" width="300" height="300" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
		<defs>
			<linearGradient id="grad1" x1="50%" y1="0%" x2="50%" y2="100%" gradientUnits="userSpaceOnUse">
			  <stop offset="0%" style="stop-color:rgb(255,255,255);stop-opacity:1" />
			  <stop offset="0%" style="stop-color:rgb(255,255,255);stop-opacity:1" />
			  <stop offset="100%" style="stop-color:rgb(50,50,255);stop-opacity:1" />
			</linearGradient>
			<radialGradient id="grad2" cx="50%" cy="50%" r="50%" fx="50%" fy="50%" gradientUnits="userSpaceOnUse">
			  <stop offset="0%" style="stop-color:rgb(255,255,255);stop-opacity:1" />
			  <stop offset="100%" style="stop-color:rgb(0,0,255);stop-opacity:1" />
			</radialGradient>
			<pattern id="img1" patternUnits="userSpaceOnUse" width="100%" height="100%">
				<image href="img/pnggrad16rgb.png" x="0" y="0" width="100%" height="100%" />
			</pattern>
		</defs>
		
		<g class="bgSVG">

		</g>
		<g class="fgSVG">
			
		</g>
	</svg>
</div>
<div class="tools">
	<select id="textStyle">
		<option value="image">Image BG</option>
		<option value="neon">Neon</option>
		<option value="gradient">Gradient</option>
		<option value="isometric">Isometric</option>
		<option value="3D">3D</option>
		<option value="embossed">Embossed</option>
		<option value="twisted">Twisted</option>
		<option value="pixel">Pixel</option>
		<option value="sunburst">Sunburst</option>
	</select>
	<div class="twistedOptions">
		<div>Width: <input id="strandWidth" type="number" value="3" min="0"></input></div>
		<div>Length: <input id="strandLength" type="number" value="8" min="0"></input></div>
		<div>Colors: <textarea id="strandColors" type="text">red, white, blue</textarea></div>
	</div>
	<div class="pixelOptions">
		<div>Thickness: <input id="pixelThickness" type="number" value="10" min="0"></input></div>
		<div>Height: <input id="pixelHeight" type="number" value="60" min="0"></input></div>
		<div>Colors: <textarea id="pixelColors" type="text">black, gray, white</textarea></div>
	</div>
	<button onclick="selectGroup();">Group</button>
	<button onclick="downloadImage();">Download</button>
	<a id="downloadLink" download="a.png" href="">Download</a>
	<span id="pointerType"></span>
	<div id="pointerIds">
	
	</div>
	<form action="/save.html" method="post">
		<input type="text" id="name" name="name" />
		<input type="text" id="svgForm" name="svg" style="display: none;" />
		<input type="text" id="curvesForm" name="curves" style="display: none;" />
		<button type="submit">Save</button>
	</form>
</div>

<script src="js/twisted.js">
</script>
<script>
var canvas = document.querySelector('canvas');
var ctx = canvas.getContext("2d");
var img = document.getElementById("imgBG");
//img.onload = function(){ctx.drawImage(img, 0, 0, 300, 300);}

var curveWorker = new Worker('js/curveWorker.js');
var inputEl = document.querySelector('.input');
var outputEl = document.querySelector('.output');
inputEl.addEventListener('pointerdown',inputDown);
inputEl.addEventListener('pointermove',inputMove);
inputEl.addEventListener('pointercancel',inputCancel);
inputEl.addEventListener('pointerup',inputUp);
inputEl.addEventListener('dragstart',inputDrag);
inputEl.addEventListener('touchmove',inputDrag);
inputEl.addEventListener('touchdown',inputDrag);
var currentCurve = [];
var allCurves = {};
var isDown = false;
var isGroup = false;

curveWorker.onmessage = function(evt){
	if (evt.data.type == 'inputCurve'){
		for (var i=0;i<evt.data.points.length;i++){
			drawCurveIn(evt.data.points[i]);
		}
	}
	else if (evt.data.type == 'outputCurve'){
		drawCurveOut(evt.data.id,evt.data.pd,evt.data.startPoint,evt.data.endPoint);
	}
	else if (evt.data.type == 'convexHull'){
		//drawConvexHull(evt.data.pdArray);
	}
}
function inputDrag(evt){
	evt.preventDefault();
	evt.stopPropagation();
	document.getElementById('pointerType').innerHTML = evt.pointerType+'drag';
}
function inputCancel(evt){
	if (evt.pointerType == 'pen'){
		evt.preventDefault();
		document.getElementById('pointerType').innerHTML = evt.pointerType+'cancel';
	}
}
function inputDown(evt) {
	evt.preventDefault();
	evt.stopPropagation();
	if (evt.pointerType == 'pen'){
		document.getElementById('pointerType').innerHTML = evt.pointerType;
		curveWorker.postMessage({'type':'down','x':evt.clientX,'y':evt.clientY});
		isDown = true;
	}
	else {
		//document.getElementById('pointerType').innerHTML = evt.pointerType;
	}
}
function inputMove(evt) {
	evt.preventDefault();
	evt.stopPropagation();
	var el = document.getElementById('pointerIds');
	el.innerHTML += evt.pointerId;
	if (evt.pointerType == 'pen'){
		document.getElementById('pointerType').innerHTML = evt.pointerType+"move";
		curveWorker.postMessage({'type':'move','x':evt.clientX,'y':evt.clientY});
	}
	else {
	}
}
function inputUp(evt) {
	evt.preventDefault();
	evt.stopPropagation();
	if (isDown && evt.pointerType == 'pen'){
		document.getElementById('pointerType').innerHTML = evt.pointerType+"up";
		isDown = false;
		
		curveWorker.postMessage({'type':'up','x':evt.clientX,'y':evt.clientY});
	}
	else {
	}
}

function drawCurveIn(pt){
	
	var el = document.createElement('div');
	el.classList.add("pt");
	el.style.left = pt[0]+"px";
	el.style.top = pt[1]+"px";
	inputEl.appendChild(el);
}
var textStyle = 'twisted';
var textBG = 'gradient';
textBG = 'white';
var textOptions = {'skewAngle':'-15','depth':32};
var heartFill = document.querySelector('.o2 .bgSVG');
function drawCurveOut(id,pd,startPoint,endPoint){
	var svg = document.querySelector('.o2 .bgSVG');
	allCurves[id]= pd;
	
	if (textStyle == '3D'){
		for (var i=0;i<8;i++){
			var path = document.createElementNS("http://www.w3.org/2000/svg", 'path');
	
			path.setAttribute('d',pd);
			path.setAttribute('stroke','rgba(0,0,0,'+(1.0-i*0.1)+')');
			path.setAttribute('stroke-width','5');
			path.setAttribute('fill','none');
			path.id = "bg-"+id+"-"+i;
			path.setAttribute('transform','translate(0 '+(8-i*1)+')');
			svg.appendChild(path);
		}
	}
	else if (textStyle == 'embossed'){
		for (var i=0;i<6;i++){
			var path = document.createElementNS("http://www.w3.org/2000/svg", 'path');
	
			path.setAttribute('d',pd);
			
			path.setAttribute('stroke-width','5');
			path.setAttribute('fill','none');
			path.id = "bg-"+id+"-"+i;
			if (i < 3){
				path.setAttribute('stroke','rgba(255,255,255,'+(0.33+i/3)+')');
				path.setAttribute('transform','translate(0 -'+(3-i)+')');
			}
			else{
				path.setAttribute('stroke','rgba(0,0,0,'+(-0.66+i/3)+')');
				path.setAttribute('transform','translate(0 '+(6-i)+')');
			}
			svg.appendChild(path);
		}
	}
	else if (textStyle == 'isometric'){
		svg.style.transform = "skew(0deg, "+textOptions.skewAngle+"deg)";
		for (var i=0;i<textOptions.depth;i++){
			var path = document.createElementNS("http://www.w3.org/2000/svg", 'path');
	
			path.setAttribute('d',pd);
			path.setAttribute('stroke','rgba(0,0,0,'+(0.0+i*1.0/textOptions.depth)+')');
			path.setAttribute('stroke-width','5');
			path.setAttribute('fill','none');
			path.id = "bg-"+id+"-"+i;
			path.setAttribute('transform','translate(-'+(textOptions.depth-i*1)+' -'+(textOptions.depth-i*1)+')');
			svg.appendChild(path);
		}
	}
	else if (textStyle == 'neon'){
		
		//outline(pd,25,'out');
		//outline(pd,25,'in');
		var width = 1;
		var intensity = 2;
		for (var i=1;i<11;i++){
			var filter = document.createElementNS("http://www.w3.org/2000/svg", 'filter');
			filter.id = 'blur-'+i;
			var filterBlur = document.createElementNS("http://www.w3.org/2000/svg", 'feGaussianBlur');
			filterBlur.setAttribute('in','SourceGraphic');
			filterBlur.setAttribute('stdDeviation',''+(i*width/2));
			filterBlur.setAttribute('edgeMode','duplicate');
			filter.appendChild(filterBlur);
			svg.appendChild(filter);
		}
		var g = document.createElementNS("http://www.w3.org/2000/svg", 'g');
		var rect = document.createElementNS("http://www.w3.org/2000/svg", 'rect');
	
		rect.setAttribute('x','0');
		rect.setAttribute('y','0');
		rect.setAttribute('width','100%');
		rect.setAttribute('height','100%');
		rect.setAttribute('fill','rgba(0,0,0,0)');
		g.appendChild(rect);
		var widths = [5+5*width,5+3*width,5+2*width,5+width,5]
		var alphas = [];
		if (intensity > 1){
			alphas = [0.1,0.3,0.7,0.9,1]
		}
		else {
			alphas = [0.2,0.4,0.6,0.8,1]
		}
		for (var i=0;i<5;i++){
			var gg = document.createElementNS("http://www.w3.org/2000/svg", 'g');
			var rect = document.createElementNS("http://www.w3.org/2000/svg", 'rect');
	
			rect.setAttribute('x','0');
			rect.setAttribute('y','0');
			rect.setAttribute('width','100%');
			rect.setAttribute('height','100%');
			rect.setAttribute('fill','rgba(0,0,0,0)');
			var path = document.createElementNS("http://www.w3.org/2000/svg", 'path');
	
			path.setAttribute('d',pd);
			path.setAttribute('stroke','rgba(255,0,0,'+alphas[i]+')');
			path.setAttribute('stroke-width',''+widths[i]);
			path.setAttribute('fill','none');
			path.id = "bg-"+id+"-"+i;
			if (i > 1){
				gg.appendChild(rect);
				gg.appendChild(path);
				gg.setAttribute('filter','url(#blur-'+(10-i*2)+')');
			}
			else {
				gg.appendChild(path);
			}
			g.appendChild(gg);
		}
		g.setAttribute('filter','url(#blur-5)');
		svg.appendChild(g);
		
		/*var path = document.createElementNS("http://www.w3.org/2000/svg", 'path');
	
		path.setAttribute('d',pd);
		path.setAttribute('stroke','rgba(255,0,0,0)');
		path.setAttribute('stroke-width',''+(60-6*0));
		path.setAttribute('fill','none');
		path.id = "bg-"+id+"-"+i;
		svg.appendChild(path);*/
	}
	else if (textStyle == 'twisted'){
		
		var path = document.createElementNS("http://www.w3.org/2000/svg", 'path');

		path.setAttribute('d',pd);
		path.setAttribute('stroke','none');
		path.setAttribute('stroke-width','1');
		path.setAttribute('fill','none');
		path.id = "bg-"+id+"-"+i;
		svg.appendChild(path);
		
		var colors = textOptions.strandColors.split(',');
		var colorsEnd = ['white','black','blue'];
		/*for (var i=0;i<3;i++){
			var newDef = document.createElementNS("http://www.w3.org/2000/svg", 'defs');
			var lG = document.createElementNS("http://www.w3.org/2000/svg", 'linearGradient');
			lG.id="linear-grad-"+i;
	
	
			lG.setAttribute('x1','0');
			lG.setAttribute('y1','50%');
			lG.setAttribute('x2','100%');
			lG.setAttribute('y2','100%');
	
		
			lG.setAttribute('gradientUnits','userSpaceOnUse');
			var newStop = document.createElementNS("http://www.w3.org/2000/svg", 'stop');
			newStop.setAttribute('offset','0%');
			newStop.setAttribute('stop-color',colors[i]);
			newStop.setAttribute('stop-opacity','1.0');
			lG.appendChild(newStop);
			var newStopT = document.createElementNS("http://www.w3.org/2000/svg", 'stop');
			newStopT.setAttribute('offset','100%');
			newStopT.setAttribute('stop-color',colorsEnd[i]);
			newStopT.setAttribute('stop-opacity','1.0');
			lG.appendChild(newStopT);
			newDef.appendChild(lG);

			heartFill.appendChild(newDef);
		}*/
		
		twist(path,colors,'open',parseFloat(textOptions['strandWidth']),parseFloat(textOptions['strandLength']));
		
		
	}
	else if (textStyle == 'sunburst'){
		
		var path = document.createElementNS("http://www.w3.org/2000/svg", 'path');

		path.setAttribute('d',pd+"Z");
		path.setAttribute('stroke','none');
		path.setAttribute('stroke-width','1');
		path.setAttribute('fill','none');
		path.id = "bg-"+id+"-"+i;
		svg.appendChild(path);
		
		var colors = textOptions.strandColors.split(',');
		
		sunburst(path,colors);

	}
	else if (textStyle == 'pixel'){
		
		
		
		createPixelArt();
		

	}
	
	
	var svg2 = document.querySelector('.o2  .fgSVG');
	if (textStyle == 'isometric'){
		svg2.style.transform = "skew(0deg, "+textOptions.skewAngle+"deg)";
	}
	var path2 = document.createElementNS("http://www.w3.org/2000/svg", 'path');
	path2.setAttribute('d',pd);
	if (textStyle == 'twisted' || textStyle == 'sunburst'){
		svg2.style.stroke = 'none';
	}
	else if (textStyle == 'embossed'){
		svg2.style.stroke = 'gray';
	}
	else if (textBG == 'gradient'){
		svg2.style.stroke = 'url(#img1)';
	}
	else {
		svg2.style.stroke = 'white';
	}
	
	svg2.style.strokeWidth = '5';
	svg2.style.fill = 'none';
	
	path2.id = "fg-"+id;
	
	if (textStyle == 'twisted' || textStyle == 'sunburst'){
		
	}
	else {
		svg2.appendChild(path2);
	}
	
	
	
	var svgForm = document.getElementById('svgForm');
	svgForm.value = document.getElementById('textSVG').outerHTML;
	var curvesForm = document.getElementById('curvesForm');
	curvesForm.value = JSON.stringify(allCurves);

}

function imgDataToDiv(div,imgData,rows,cols){
	var s = 5;
	div.setAttribute('width',s*cols);
	div.setAttribute('height',s*rows);
	div.setAttribute('viewBox','0 0 '+s*cols+' '+s*rows);
	var colorPaths = {};
	for (var i=0;i<colorSet.length;i++){
		var rgba = colorSet[i];
		colorPaths[rgba]="";
	}
	for (var i=0;i<rows;i++){
		var row = document.createElement('div');
		for (var ii=0;ii<cols;ii++){
			
			
			var r = imgData[4*(i*cols+ii)+0];
			var g = imgData[4*(i*cols+ii)+1];
			var b = imgData[4*(i*cols+ii)+2];
			var a = imgData[4*(i*cols+ii)+3]/255;
			var color = nearestColor(r,g,b,a);
			var rgba = color;
			
			var pd = "M "+(ii*s)+" "+(i*s)+" L "+((ii+1)*s)+" "+((i+1)*s);
			pd += " M "+((ii+1)*s)+" "+(i*s)+" L "+((ii)*s)+" "+((i+1)*s);
			colorPaths[rgba] += pd;
			
		}
	}
	for (var i=0;i<colorSet.length;i++){
		var cell = document.createElementNS("http://www.w3.org/2000/svg", 'path');
		var rgba = colorSet[i];
		cell.setAttribute('d',colorPaths[rgba]);
		cell.setAttribute('stroke',rgba);
		cell.setAttribute('stroke-width',s*0.4);
		cell.setAttribute('fill','none');
	
		div.appendChild(cell);
	}
}

function createPixelArt(){
	colorSet = textOptions.pixelColors.split(',');
	document.getElementById('pixelSVG').innerHTML = '';
	var ids = Object.keys(allCurves);
	for (var i in ids){
		var id = ids[i];
		var path = document.createElementNS("http://www.w3.org/2000/svg", 'path');
		console.log(id,ids,allCurves);
		path.setAttribute('d',allCurves[id]);
		path.setAttribute('stroke','black');
		path.setAttribute('stroke-width',parseFloat(textOptions.pixelThickness));
		path.setAttribute('fill','none');
		path.id = "bg-"+id;
		document.getElementById('pixelSVG').appendChild(path);
	}
	
	var colors = textOptions.pixelColors.split(',');
	let clonedSvgElement = document.getElementById("pixelSVG").cloneNode(true);
	var img2 = new Image();


	img2.onload = function() {
		//ctx.drawImage(img, 0, 0, 300, 300);
		ctx.clearRect(0,0,150,60);
		ctx.drawImage(img2, 0, 0,150,60);
		var pixelOut = document.getElementById('pixelOut');
		pixelOut.innerHTML = '';
		var imgData = ctx.getImageData(0,0,150,60).data;
		imgDataToDiv(pixelOut,imgData,60,150);

	}

	img2.src = "data:image/svg+xml;base64," + window.btoa(clonedSvgElement.outerHTML);
}
var colorSet = ['black','gray','white'];
//var colorSet = [{'r':0,'g':0,'b':0},{'r':255,'g':255,'b':255}];

function nearestColor(r,g,b,a) {

	var color = 'white';
	for (var i=0;i<colorSet.length-1;i++){
		if (a > (colorSet.length-i-1)/colorSet.length){
			color = colorSet[i];
			return color;
		}
	}
	return color;
}

function setOptions(evt,first=false) {
	var el = document.getElementById('textStyle');
	textStyle=el.value;
	if (first){
		el.addEventListener('change',setOptions);
	}
	
	var options = ['strandWidth','strandLength','strandColors','pixelThickness','pixelHeight','pixelColors'];
	for (var i=0;i<options.length;i++){
		var el = document.getElementById(options[i]);
		textOptions[options[i]]=el.value;
		if (first){
			el.addEventListener('change',setOptions);
		}
	}
	if (evt && evt.target && evt.target.id && evt.target.id.substring(0,5) == 'pixel'){
		
		createPixelArt();
	}
	
	
}
setOptions(false,true);



function selectGroup(){
	isGroup = true;
}

function groupDown() {

}
function groupMove() {

}
function groupUp() {
	isGroup = false;
}
function downloadImage() {
	var url = canvas.toDataURL();
	document.getElementById('downloadLink').href = url;
	console.log(url);
}

</script>
</body>
</html>

