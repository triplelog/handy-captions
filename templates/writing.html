<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
    {% block meta %}
    <meta name="description" content=".">    <title>CSS City</title>  
    <link rel="icon" type="image/png" href="../chfaviconcrop.png">
    {% endblock %}
    


{% block stylesheets %}
{% endblock %}


<style>

.input, .input-0, .input-1, .input-2 {
	position: absolute;
	left: 1rem;
	top:2rem;
	width: calc(100% - 2rem);
	height: calc(25rem);
	display: inline-block;
	border: 1px solid black;
	touch-action: none;
	overflow: auto;
}
.input, .input-0, .input-1, .input-2 {
	display: none;
}
.input-0 {
	display: inline-block;
}
.output {
	position: absolute;
	left: 0px;
	top:50%;
	width: 300px;
	height: 300px;
	display: inline-block;
	border: 1px solid red;
	/*background-image: url("img/pexels-photo-963278.jpeg");
	background-color: black;
	background-size: 300px 300px;*/
	
}
.o2 {
	position: absolute;
	left: 0rem;
	top:0rem;
	width: 600px;
	height: 600px;
	display: inline-block;
	border: 0px solid red;
	background-color: transparent;
	pointer-events: none;
	touch-action: none;
	
}
.tools {
	position: absolute;
	left: 0px;
	top:0px;
	height: 2rem;
	display: inline-block;
	
}
.pt {
	position: absolute;
	display: inline-block;
	background: black;
	width: 1px;
	height: 1px;
}



.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror pre {
  white-space: pre-wrap;
}

.ProseMirror li {
  position: relative;
}

.ProseMirror-hideselection *::selection { background: transparent; }
.ProseMirror-hideselection *::-moz-selection { background: transparent; }
.ProseMirror-hideselection { caret-color: transparent; }

.ProseMirror-selectednode {
  outline: 2px solid #8cf;
}

/* Make sure li selections wrap around markers */

li.ProseMirror-selectednode {
  outline: none;
}

li.ProseMirror-selectednode:after {
  content: "";
  position: absolute;
  left: -32px;
  right: -2px; top: -2px; bottom: -2px;
  border: 2px solid #8cf;
  pointer-events: none;
}




.ProseMirror-textblock-dropdown {
  min-width: 3em;
}

.ProseMirror-menu {
  margin: 0 -4px;
  line-height: 1;
}

.ProseMirror-tooltip .ProseMirror-menu {
  width: -webkit-fit-content;
  width: fit-content;
  white-space: pre;
}

.ProseMirror-menuitem {
  margin-right: 3px;
  display: inline-block;
}

.ProseMirror-menuseparator {
  border-right: 1px solid #ddd;
  margin-right: 3px;
}

.ProseMirror-menu-dropdown, .ProseMirror-menu-dropdown-menu {
  font-size: 90%;
  white-space: nowrap;
}

.ProseMirror-menu-dropdown {
  vertical-align: 1px;
  cursor: pointer;
  position: relative;
  padding-right: 15px;
}

.ProseMirror-menu-dropdown-wrap {
  padding: 1px 0 1px 4px;
  display: inline-block;
  position: relative;
}

.ProseMirror-menu-dropdown:after {
  content: "";
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-top: 4px solid currentColor;
  opacity: .6;
  position: absolute;
  right: 4px;
  top: calc(50% - 2px);
}

.ProseMirror-menu-dropdown-menu, .ProseMirror-menu-submenu {
  position: absolute;
  background: white;
  color: #666;
  border: 1px solid #aaa;
  padding: 2px;
}

.ProseMirror-menu-dropdown-menu {
  z-index: 15;
  min-width: 6em;
}

.ProseMirror-menu-dropdown-item {
  cursor: pointer;
  padding: 2px 8px 2px 4px;
}

.ProseMirror-menu-dropdown-item:hover {
  background: #f2f2f2;
}

.ProseMirror-menu-submenu-wrap {
  position: relative;
  margin-right: -4px;
}

.ProseMirror-menu-submenu-label:after {
  content: "";
  border-top: 4px solid transparent;
  border-bottom: 4px solid transparent;
  border-left: 4px solid currentColor;
  opacity: .6;
  position: absolute;
  right: 4px;
  top: calc(50% - 4px);
}

.ProseMirror-menu-submenu {
  display: none;
  min-width: 4em;
  left: 100%;
  top: -3px;
}

.ProseMirror-menu-active {
  background: #eee;
  border-radius: 4px;
}

.ProseMirror-menu-disabled {
  opacity: .3;
}

.ProseMirror-menu-submenu-wrap:hover .ProseMirror-menu-submenu, .ProseMirror-menu-submenu-wrap-active .ProseMirror-menu-submenu {
  display: block;
}

.ProseMirror-menubar {
  border-top-left-radius: inherit;
  border-top-right-radius: inherit;
  position: relative;
  min-height: 1em;
  color: #666;
  padding: 1px 6px;
  top: 0; left: 0; right: 0;
  border-bottom: 1px solid silver;
  background: white;
  z-index: 10;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  overflow: visible;
}

.ProseMirror-icon {
  display: inline-block;
  line-height: .8;
  vertical-align: -2px; /* Compensate for padding */
  padding: 2px 8px;
  cursor: pointer;
}

.ProseMirror-menu-disabled.ProseMirror-icon {
  cursor: default;
}

.ProseMirror-icon svg {
  fill: currentColor;
  height: 1em;
}

.ProseMirror-icon span {
  vertical-align: text-top;
}


.ProseMirror-focused:focus {
	outline: none;
}
</style>
</head>
<body>
<div class="tools">
	<button onclick="show(0);">0</button>
	<button onclick="show(1);">1</button>
	<button onclick="show(2);">2</button>
	<button onclick="resetAnchor();">A</button>
	<button onclick="writingMode();">W</button>
</div>
<div class="input">

</div>
<div id="tab-0" class="input-0">

</div>
<div id="tab-1" class="input-1">

</div>
<div id="tab-2" class="input-2">

</div>
<div style="display: none" id="content">
  <h3>Hello ProseMirror</h3>
  <p>This is editable text. You can focus it and start typing.</p>
  <p>To apply styling, you can select a piece of text and manipulate
  its styling from the menu. The basic schema
  supports <em>emphasis</em>, <strong>strong
  text</strong>, <a href="">links</a>, <code>code
  font</code>, and images.</p>
  <p>Block-level structure can be manipulated with key bindings (try
  ctrl-shift-2 to create a level 2 heading, or enter in an empty
  textblock to exit the parent block), or through the menu.</p>
  <p>Try using the “list” item in the menu to wrap this paragraph in
  a numbered list.</p>
</div>
<div style="display: none" id="content2">
  <h3>Hello ProseMirror</h3>
</div>
<div class="o2" >
	<svg id="textSVG" viewBox="0 0 600 600" width="600" height="600" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
		<defs>
			<linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
			  <stop offset="0%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
			  <stop offset="100%" style="stop-color:rgb(255,0,0);stop-opacity:1" />
			</linearGradient>
			<radialGradient id="grad2" cx="50%" cy="50%" r="50%" fx="50%" fy="50%" gradientUnits="userSpaceOnUse">
			  <stop offset="0%" style="stop-color:rgb(0,0,0);stop-opacity:1" />
			  <stop offset="100%" style="stop-color:rgb(0,0,255);stop-opacity:1" />
			</radialGradient>
			<pattern id="img1" patternUnits="userSpaceOnUse" width="100%" height="100%">
				<image href="img/pnggrad16rgb.png" x="0" y="0" width="100%" height="100%" />
			</pattern>
		</defs>
		
		<g class="bgSVG">

		</g>
		<g class="fgSVG">
			
		</g>
	</svg>
</div>


<script>

var curveWorker = new Worker('js/curveWorker.js');
var inputEl = document.querySelector('.input');
var outputEl = document.querySelector('.output');
inputEl.addEventListener('pointerdown',inputDown);
inputEl.addEventListener('pointermove',inputMove);
inputEl.addEventListener('pointerup',inputUp);

var currentCurve = [];
var allCurves = {};
var isDown = false;
var isGroup = false;

curveWorker.onmessage = function(evt){
	if (evt.data.type == 'inputCurve'){
		for (var i=0;i<evt.data.points.length;i++){
			drawCurveIn(evt.data.points[i]);
		}
	}
	else if (evt.data.type == 'outputCurve'){
		drawCurveOut(evt.data.id,evt.data.pd,evt.data.startPoint,evt.data.endPoint);
	}
	else if (evt.data.type == 'convexHull'){
		drawConvexHull(evt.data.pdArray);
	}
}

function inputDown(evt) {
	curveWorker.postMessage({'type':'down','x':evt.clientX,'y':evt.clientY});
	isDown = true;
}
function inputMove(evt) {
	if (isDown){
		curveWorker.postMessage({'type':'move','x':evt.clientX,'y':evt.clientY});
	}
}
function inputUp(evt) {
	if (isDown){
		console.log(evt);
		isDown = false;
		
		curveWorker.postMessage({'type':'up','x':evt.clientX,'y':evt.clientY});
	}
}

function drawCurveIn(pt){
	
	var el = document.createElement('div');
	el.classList.add("pt");
	el.style.left = pt[0]+"px";
	el.style.top = pt[1]+"px";
	inputEl.appendChild(el);
}
function drawCurveOut(id,pd,startPoint,endPoint){
	var svg = document.querySelector('.o2 .bgSVG');
	var path0 = document.createElementNS("http://www.w3.org/2000/svg", 'path');
	
	path0.setAttribute('d',pd);
	path0.setAttribute('stroke','none');
	path0.setAttribute('stroke-width','11');
	path0.setAttribute('fill','none');
	path0.id = "bbg-"+id;
	svg.appendChild(path0);
	

	var path = document.createElementNS("http://www.w3.org/2000/svg", 'path');
	
	path.setAttribute('d',pd);
	path.setAttribute('stroke','none');
	path.setAttribute('stroke-width','7');
	path.setAttribute('fill','none');
	path.id = "bg-"+id;
	svg.appendChild(path);
	
	var svg2 = document.querySelector('.o2  .fgSVG');
	var path2 = document.createElementNS("http://www.w3.org/2000/svg", 'path');
	path2.setAttribute('d',pd);
	path2.setAttribute('stroke','none');
	path2.setAttribute('stroke-width','5');
	path2.setAttribute('fill','none');
	path2.id = "fg-"+id;
	svg2.appendChild(path2);
	
	allCurves[id]= currentCurve;
	console.log(allCurves);
}

function drawConvexHull(pdArray) {
	for (var i=0;i<10;i++){
		var el = document.querySelector('.convexHull-'+i);
		el.setAttribute('d',pdArray[i]);
	}
	
	let clonedSvgElement = document.getElementById("textSVG").cloneNode(true);
	var img2 = new Image();
	
	img2.onload = function() {
		ctx.drawImage(img, 0, 0, 300, 300);
		ctx.drawImage(img2, 0, 0,300,300);
		
	}
	img2.src = "data:image/svg+xml;base64," + window.btoa(clonedSvgElement.outerHTML);
	
	

	

}

var currentTab = 0;
function show(id) {
	pm.chgTab(currentTab,id);
	var el0 = document.querySelector('.input-0');
	el0.style.display = "none";
	var el1 = document.querySelector('.input-1');
	el1.style.display = "none";
	var el2 = document.querySelector('.input-2');
	el2.style.display = "none";
	var el = document.querySelector('.input-'+id);
	el.style.display = "inline-block";
	currentTab = id;
	
}
function resetAnchor() {
	pm.resetAnchor();
}
function writingMode() {
	pm.writingMode();
}


</script>

<script src="js/pm.bundle.js"></script>

<script>
console.log(pm);
</script>
</body>
</html>

